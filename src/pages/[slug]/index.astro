---
import Page from '../../layouts/Page.astro';
import TabSwiper from '../../components/vue/TabSwiper.vue';

import {
  groupStandingsByLeague,
  groupFixturesByLeague,
  groupResultsByLeague,
} from '../../utils';

const { union } = Astro.props;

import { unions, loadUnionData } from '../../unions.ts';
export async function getStaticPaths() {
  return unions.map((union) => ({
    params: { slug: union.slug },
    props: { union },
  }));
}

// only union specific data
const data = loadUnionData(union.slug);
const { clubs, fixtures, leagues, results, standings } = data;

// id: { id, name, logo }
const clubsMap = Object.fromEntries(
  clubs.map((club) => {
    const id = club.id;
    return [
      id,
      {
        id,
        name: club.name || null,
        logo: club.logo_url || null,
      },
    ];
  })
);

// id: { id, name }
const leaguesMap = Object.fromEntries(
  leagues.map((league) => {
    const id = league.id;
    return [
      id,
      {
        id,
        name: league.name || null,
      },
    ];
  })
);
---

<Page union={union}>
  <TabSwiper
    client:load
    union={union}
    clubs={clubsMap}
    leagues={leaguesMap}
    standings={groupStandingsByLeague(standings)}
    fixtures={groupFixturesByLeague(fixtures)}
    results={groupResultsByLeague(results)}
  />
</Page>
